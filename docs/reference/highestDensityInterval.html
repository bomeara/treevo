<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Highest Density Interval — highestDensityInterval • TreEvo</title>


<!-- jquery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
<!-- Bootstrap -->

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous" />

<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script>

<!-- bootstrap-toc -->
<link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script>

<!-- Font Awesome icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous" />

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script>

<!-- headroom.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>




<meta property="og:title" content="Highest Density Interval — highestDensityInterval" />
<meta property="og:description" content="This function calculates highest density intervals (HDIs) for a given univariate vector.
Typically, this is done to obtain highest posterior density (HPD) for each freely varying
parameter estimated in the posterior of a Bayesian MCMC analysis. If these intervals are
calculated for more than one variable, they are referred to instead as regions." />




<!-- mathjax -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->



  </head>

  <body data-spy="scroll" data-target="#toc">
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">TreEvo</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.22.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="../articles/treevo_ABC_vignette.html">Analyzing Trait Evolution with Approximate Bayesian Computation in TreEvo</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/bomeara/TreEvo/">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Highest Density Interval</h1>
    <small class="dont-index">Source: <a href='https://github.com/bomeara/TreEvo/blob/master/R/highestDensityInterval.R'><code>R/highestDensityInterval.R</code></a></small>
    <div class="hidden name"><code>highestDensityInterval.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>This function calculates highest density intervals (HDIs) for a given univariate vector.
Typically, this is done to obtain highest posterior density (HPD) for each freely varying
parameter estimated in the posterior of a Bayesian MCMC analysis. If these intervals are
calculated for more than one variable, they are referred to instead as regions.</p>
    </div>

    <pre class="usage"><span class='fu'>highestDensityInterval</span><span class='op'>(</span>
  <span class='va'>dataVector</span>,
  <span class='va'>alpha</span>,
  coda <span class='op'>=</span> <span class='cn'>FALSE</span>,
  verboseMultimodal <span class='op'>=</span> <span class='cn'>TRUE</span>,
  stopIfFlat <span class='op'>=</span> <span class='cn'>TRUE</span>,
  <span class='va'>...</span>
<span class='op'>)</span></pre>

    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>dataVector</th>
      <td><p>A vector of data, which can be reasonably assumed to
represent independent, identically-distributed random variables, such as
estimates of a parameter from a Bayesian MCMC.</p></td>
    </tr>
    <tr>
      <th>alpha</th>
      <td><p>The threshold used for defining the highest density frequency
cut-off. If the highest density interval is applied to a Bayesian MCMC
posterior sample, then the interval is effectively calculated for this
value as a posterior probability density.</p></td>
    </tr>
    <tr>
      <th>coda</th>
      <td><p>Default is <code>FALSE</code>. If <code>TRUE</code>, unimodal highest density regions will
instead be calculated using <code>HPDinterval</code> from package <code>coda</code>, which is
similar to the function <code>quantile</code> in that it calculates only a single interval.</p></td>
    </tr>
    <tr>
      <th>verboseMultimodal</th>
      <td><p>If <code>TRUE</code>, the function will print a message
indicating when the inferred highest density interval is discontinuous, and
thus likely reflects that the supplied data is multimodal.</p></td>
    </tr>
    <tr>
      <th>stopIfFlat</th>
      <td><p>If <code>TRUE</code> (the default), the function will terminate
and return an error if the distribution appears to be flat, with a
high number of tied values in the posterior. 
If <code>FALSE</code>, the function will instead attempt to move forward,
while returning a warning instead. The latter option is
mainly implemented so internal calls to <code>highestDensityInterval</code>
do not block otherwise long-running analyses.</p></td>
    </tr>
    <tr>
      <th>...</th>
      <td><p>Additional arguments passed to <code><a href='https://rdrr.io/r/stats/density.html'>density</a></code>. 
A user may want to mess with this to adjust bandwidth, et cetera.</p></td>
    </tr>
    </table>

    <h2 class="hasAnchor" id="details"><a class="anchor" href="#details"></a>Details</h2>

    <p>By default, HDI calculation is preformed by fitting
a kernal density estimate (KDE) via R function <code>density</code>
with default bandwidth, rescaling the kernal to a density, sorting intervals along the KDE
by that density, and then summing these values from largest to smallest, until the desired
alpha is reached. This algorithm is quick, and accounts for potentially multimodal distributions, 
or those with complex shapes, unlike unimodal intervals, such as quantiles, or the
<code>HPDinterval</code> in package <code>coda</code>.</p>
<p>Alternatively, a user can opt to use function <code>HPDinterval</code> from package <code>coda</code>
to calculate highest density intervals. These will work as long as the data has a single mode
- data with multiple modes may have overly large quantiles (to encompass those multiple modes), 
resulting in overly wide estimates of coverage.</p>
    <h2 class="hasAnchor" id="references"><a class="anchor" href="#references"></a>References</h2>

    <p>Hyndman, R. J. 1996. Computing and Graphing Highest
Density Regions. <em>The American Statistician</em> 50(2):120-126.</p>
    <h2 class="hasAnchor" id="see-also"><a class="anchor" href="#see-also"></a>See also</h2>

    <div class='dont-index'><p><code>HPDinterval</code> in package <code>coda</code> for an
alternative used by older versions of <code>TreEvo</code>
which cannot properly handle multimodal distributions.</p></div>

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><div class='input'><span class='fu'><a href='https://rdrr.io/r/base/Random.html'>set.seed</a></span><span class='op'>(</span><span class='fl'>444</span><span class='op'>)</span>

<span class='co'># let's imagine we have some variable with</span>
    <span class='co'># an extreme bimodal distribution</span>
<span class='va'>z</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/sample.html'>sample</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/stats/Normal.html'>rnorm</a></span><span class='op'>(</span><span class='fl'>50</span>, <span class='fl'>1</span>, <span class='fl'>2</span><span class='op'>)</span>, <span class='fu'><a href='https://rdrr.io/r/stats/Normal.html'>rnorm</a></span><span class='op'>(</span><span class='fl'>100</span>, <span class='fl'>50</span>, <span class='fl'>3</span><span class='op'>)</span><span class='op'>)</span><span class='op'>)</span>
<span class='fu'><a href='https://rdrr.io/r/graphics/hist.html'>hist</a></span><span class='op'>(</span><span class='va'>z</span><span class='op'>)</span>
</div><div class='img'><img src='highestDensityInterval-1.png' alt='' width='700' height='433' /></div><div class='input'>
<span class='co'># now let's say we want to know the what sort of values</span>
<span class='co'># are reasonably consistent with this distribution</span>

<span class='co'># for example, let's say we wanted the ranges within</span>
<span class='co'># which 80% of our data occurs</span>

<span class='co'># one way to do this would be a quantile</span>
    <span class='co'># two tailed 80% quantiles</span>
<span class='fu'><a href='https://rdrr.io/r/stats/quantile.html'>quantile</a></span><span class='op'>(</span><span class='va'>z</span>, probs <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>0.1</span>, <span class='fl'>0.9</span><span class='op'>)</span><span class='op'>)</span>
</div><div class='output co'>#&gt;       10%       90% 
#&gt; -0.774775 54.214837 </div><div class='input'>
<span class='co'># that seems overly broad - there's essentially no density</span>
<span class='co'># in the central valley - but we want to exclude values found there!</span>
<span class='co'># A value of 30 doesn't match this data sample, right??</span>

<span class='co'># the problem is that all quantile methods are essentially based on</span>
<span class='co'># the empirical cumulative distribution function - which is monotonic</span>
<span class='co'># (as any cumulutative function should be), and thus</span>
<span class='co'># quantiles can only be a single interval</span>

<span class='co'># A different approach is to use density from stats</span>
<span class='fu'><a href='https://rdrr.io/r/stats/density.html'>density</a></span><span class='op'>(</span><span class='va'>z</span><span class='op'>)</span>
</div><div class='output co'>#&gt; 
#&gt; Call:
#&gt; 	density.default(x = z)
#&gt; 
#&gt; Data: z (150 obs.);	Bandwidth 'bw' = 7.836
#&gt; 
#&gt;        x                  y            
#&gt;  Min.   :-26.6190   Min.   :5.516e-05  
#&gt;  1st Qu.:  0.1252   1st Qu.:1.175e-03  
#&gt;  Median : 26.8694   Median :6.011e-03  
#&gt;  Mean   : 26.8694   Mean   :9.336e-03  
#&gt;  3rd Qu.: 53.6136   3rd Qu.:1.524e-02  
#&gt;  Max.   : 80.3578   Max.   :3.169e-02  </div><div class='input'><span class='co'># we could then take the density estimates for</span>
<span class='co'># particular intervals, rank-order them, and</span>
<span class='co'># then cumulative sample until we reach</span>
<span class='co'># our desired probability density (alpha)</span>

<span class='co'># let's try that</span>
<span class='va'>alpha</span> <span class='op'>&lt;-</span> <span class='fl'>0.8</span>
<span class='va'>zDensOut</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/stats/density.html'>density</a></span><span class='op'>(</span><span class='va'>z</span><span class='op'>)</span>
<span class='va'>zDensity</span> <span class='op'>&lt;-</span> <span class='va'>zDensOut</span><span class='op'>$</span><span class='va'>y</span><span class='op'>/</span><span class='fu'><a href='https://rdrr.io/r/base/sum.html'>sum</a></span><span class='op'>(</span><span class='va'>zDensOut</span><span class='op'>$</span><span class='va'>y</span><span class='op'>)</span>
<span class='va'>inHPD</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/cumsum.html'>cumsum</a></span><span class='op'>(</span><span class='op'>-</span><span class='fu'><a href='https://rdrr.io/r/base/sort.html'>sort</a></span><span class='op'>(</span><span class='op'>-</span><span class='va'>zDensity</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>&lt;=</span> <span class='va'>alpha</span>
<span class='co'># now reorder</span>
<span class='va'>inHPD</span> <span class='op'>&lt;-</span> <span class='va'>inHPD</span><span class='op'>[</span><span class='fu'><a href='https://rdrr.io/r/base/order.html'>order</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/order.html'>order</a></span><span class='op'>(</span><span class='op'>-</span><span class='va'>zDensity</span><span class='op'>)</span><span class='op'>)</span><span class='op'>]</span>
<span class='va'>colDens</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/rep.html'>rep</a></span><span class='op'>(</span><span class='fl'>1</span>, <span class='fu'><a href='https://rdrr.io/r/base/length.html'>length</a></span><span class='op'>(</span><span class='va'>zDensity</span><span class='op'>)</span><span class='op'>)</span>
<span class='va'>colDens</span><span class='op'>[</span><span class='va'>inHPD</span><span class='op'>]</span> <span class='op'>&lt;-</span> <span class='fl'>2</span>
<span class='co'># and let's plot it, with colors</span>
<span class='fu'><a href='https://rdrr.io/r/graphics/plot.default.html'>plot</a></span><span class='op'>(</span><span class='va'>zDensOut</span><span class='op'>$</span><span class='va'>x</span>, <span class='va'>zDensity</span>, col <span class='op'>=</span> <span class='va'>colDens</span><span class='op'>)</span>
</div><div class='img'><img src='highestDensityInterval-2.png' alt='' width='700' height='433' /></div><div class='input'>
<span class='co'># and we can do all that (except the plotting)</span>
    <span class='co'># with highestDensityInterval</span>
<span class='fu'>highestDensityInterval</span><span class='op'>(</span><span class='va'>z</span>, alpha <span class='op'>=</span> <span class='fl'>0.8</span><span class='op'>)</span>
</div><div class='output co'>#&gt; <span class='message'>Inferred highest density intervals are discontinuous, suggesting data may have multiple modes</span></div><div class='output co'>#&gt;      LowerBound_alpha=0.8 UpperBound_alpha=0.8
#&gt; [1,]            -7.149641             8.132761
#&gt; [2,]            37.860174            62.772584</div><div class='input'>
<span class='co'>#############################</span>
<span class='co'># example with output from doRun_prc</span>
<span class='fu'><a href='https://rdrr.io/r/utils/data.html'>data</a></span><span class='op'>(</span><span class='va'>simRunExample</span><span class='op'>)</span>

<span class='co'># we'll use summarizePosterior, which just automates picking</span>
  <span class='co'># the last generation, and freely-varying parameters for HDRs </span>

<span class='co'># alpha = 0.95</span>
<span class='fu'><a href='summarizePosterior.html'>summarizePosterior</a></span><span class='op'>(</span>
   <span class='va'>resultsBMExample</span><span class='op'>[[</span><span class='fl'>1</span><span class='op'>]</span><span class='op'>]</span><span class='op'>$</span><span class='va'>particleDataFrame</span>, 
   alpha <span class='op'>=</span> <span class='fl'>0.95</span><span class='op'>)</span>
</div><div class='output co'>#&gt; $starting_1
#&gt; $starting_1$mean
#&gt; [1] 9.772155
#&gt; 
#&gt; $starting_1$sd
#&gt; [1] 0.126498
#&gt; 
#&gt; $starting_1$HPD
#&gt;      LowerBound_alpha=0.95 UpperBound_alpha=0.95
#&gt; [1,]              9.478273              10.01189
#&gt; 
#&gt; 
#&gt; $intrinsic_1
#&gt; $intrinsic_1$mean
#&gt; [1] 0.03650089
#&gt; 
#&gt; $intrinsic_1$sd
#&gt; [1] 0.02126776
#&gt; 
#&gt; $intrinsic_1$HPD
#&gt;      LowerBound_alpha=0.95 UpperBound_alpha=0.95
#&gt; [1,]          -0.005969742            0.07973995
#&gt; 
#&gt; </div><div class='input'>
<span class='co'># you might be tempted to use alphas like 95%, but with bayesian statistics</span>
<span class='co'># we often don't sample the distribution well enough to know</span>
<span class='co'># its shape to exceeding detail. alpha = 0.8 may be more reasonable.</span>
<span class='fu'><a href='summarizePosterior.html'>summarizePosterior</a></span><span class='op'>(</span>
   <span class='va'>resultsBMExample</span><span class='op'>[[</span><span class='fl'>1</span><span class='op'>]</span><span class='op'>]</span><span class='op'>$</span><span class='va'>particleDataFrame</span>, 
   alpha <span class='op'>=</span> <span class='fl'>0.8</span><span class='op'>)</span>
</div><div class='output co'>#&gt; $starting_1
#&gt; $starting_1$mean
#&gt; [1] 9.772155
#&gt; 
#&gt; $starting_1$sd
#&gt; [1] 0.126498
#&gt; 
#&gt; $starting_1$HPD
#&gt;      LowerBound_alpha=0.8 UpperBound_alpha=0.8
#&gt; [1,]             9.593231             9.941538
#&gt; 
#&gt; 
#&gt; $intrinsic_1
#&gt; $intrinsic_1$mean
#&gt; [1] 0.03650089
#&gt; 
#&gt; $intrinsic_1$sd
#&gt; [1] 0.02126776
#&gt; 
#&gt; $intrinsic_1$HPD
#&gt;      LowerBound_alpha=0.8 UpperBound_alpha=0.8
#&gt; [1,]          0.004411246           0.06350302
#&gt; 
#&gt; </div><div class='input'>
</div></pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top">
      <h2 data-toc-skip>Contents</h2>
    </nav>
  </div>
</div>


      <footer>
      <div class="copyright">
  <p>Developed by Brian O'Meara, David Bapst, Barb Banbury.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
   </div>

  


  </body>
</html>


