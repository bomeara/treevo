<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Discrete-Time Character Simulation — doSimulation • TreEvo</title>


<!-- jquery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
<!-- Bootstrap -->

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous" />

<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script>

<!-- bootstrap-toc -->
<link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script>

<!-- Font Awesome icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous" />

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script>

<!-- headroom.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>




<meta property="og:title" content="Discrete-Time Character Simulation — doSimulation" />
<meta property="og:description" content="The function doSimulation evolves continuous characters under a discrete time process.
These functions are mainly used as internal components, generating simulations
within ABC analyses using the doRun functions. See Note below." />




<!-- mathjax -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->



  </head>

  <body data-spy="scroll" data-target="#toc">
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">TreEvo</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.22.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="../articles/treevo_ABC_vignette.html">Analyzing Trait Evolution with Approximate Bayesian Computation in TreEvo</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/bomeara/TreEvo/">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Discrete-Time Character Simulation</h1>
    <small class="dont-index">Source: <a href='https://github.com/bomeara/TreEvo/blob/master/R/doSimulation.R'><code>R/doSimulation.R</code></a></small>
    <div class="hidden name"><code>doSimulation.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>The function <code>doSimulation</code> evolves continuous characters under a discrete time process.
These functions are mainly used as internal components, generating simulations
within ABC analyses using the <code><a href='doRun.html'>doRun</a></code> functions. See <em>Note</em> below.</p>
    </div>

    <pre class="usage"><span class='fu'>doSimulation</span><span class='op'>(</span>
  phy <span class='op'>=</span> <span class='cn'>NULL</span>,
  <span class='va'>intrinsicFn</span>,
  <span class='va'>extrinsicFn</span>,
  <span class='va'>startingValues</span>,
  <span class='va'>intrinsicValues</span>,
  <span class='va'>extrinsicValues</span>,
  generation.time <span class='op'>=</span> <span class='fl'>1000</span>,
  TreeYears <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/Extremes.html'>max</a></span><span class='op'>(</span><span class='fu'>branching.times</span><span class='op'>(</span><span class='va'>phy</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>*</span> <span class='fl'>1e+06</span>,
  timeStep <span class='op'>=</span> <span class='cn'>NULL</span>,
  returnAll <span class='op'>=</span> <span class='cn'>FALSE</span>,
  taxonDF <span class='op'>=</span> <span class='cn'>NULL</span>,
  checkTimeStep <span class='op'>=</span> <span class='cn'>TRUE</span>
<span class='op'>)</span></pre>

    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>phy</th>
      <td><p>A phylogenetic tree, in package <code>ape</code>'s <code>phylo</code> format.</p></td>
    </tr>
    <tr>
      <th>intrinsicFn</th>
      <td><p>Name of (previously-defined) function that governs how
traits evolve within a lineage, regardless of the trait values of other taxa.</p></td>
    </tr>
    <tr>
      <th>extrinsicFn</th>
      <td><p>Name of (previously-defined) function that governs how
traits evolve within a lineage, based on their own
('internal') trait vlaue and the trait values
of other taxa.</p></td>
    </tr>
    <tr>
      <th>startingValues</th>
      <td><p>State at the root.</p></td>
    </tr>
    <tr>
      <th>intrinsicValues</th>
      <td><p>Vector of values corresponding to the parameters of the
intrinsic model.</p></td>
    </tr>
    <tr>
      <th>extrinsicValues</th>
      <td><p>Vector of values corresponding to the parameters of the
extrinsic model.</p></td>
    </tr>
    <tr>
      <th>generation.time</th>
      <td><p>The number of years per generation.
This sets the coarseness of the simulation; if it's set to 1000, 
for example, the population's trait values change every 1000
calendar years. Note that this is in calendar years (see description
for argument <code>TreeYears</code>), and not in millions of years
(as is typical for dated trees in macroevolutionary studies).
Thus, if a branch is 1 million-year time-unit long, and a
user applies the default <code>generation.time = 1000</code>, 
then 1000 evolutionary changes will be simulated along that branch.
See documentation for <code>doSimulation</code> for further details.</p></td>
    </tr>
    <tr>
      <th>TreeYears</th>
      <td><p>The amount of calendar time from the root
to the furthest tip. Most trees in macroevolutionary studies are dated with
branch lengths in units of millions of years, and thus the
default for this argument is <code>max(branching.times(phy)) * 1e6</code>.
If your tree has the most recent tip at time zero (i.e.,
the modern day), this would be the same as the root age of the tree. If your
branch lengths are not in millions of years, you should
alter this argument. Otherwise, leave this argument alone.
See documentation for <code>doSimulation</code> for further details.</p></td>
    </tr>
    <tr>
      <th>timeStep</th>
      <td><p>This value corresponds to the length
of intervals between discrete evolutionary events ('generations')
simulated along branches, relative to a rescaled tree
where the root to furthest tip distance is 1. For example, 
<code>timeStep = 0.01</code> of would mean 100 (i.e., 1 / 0.01)
evolutionary changes would be expected to occur from
the root to the furthest tip. (Note that the real number
simulated will be much less, because simulations start
over at each branching node.) Ideally, <code>timeStep</code>
(or its effective value, via other arguments) should be
as short as is computationally possible.
Typically <code>NULL</code> by default and
determined internally as follows: <code>timeStep = generation.time / TreeYears</code>.
Can be provided a value as an alternative to using arguments <code>generation.time</code>
and <code>TreeYears</code>, which would then be overridden.
See documentation for <code>doSimulation</code> for further details.</p></td>
    </tr>
    <tr>
      <th>returnAll</th>
      <td><p>If <code>TRUE</code>, the output returned is a
<code>data.frame</code> containing the values at each node from the simulation.</p></td>
    </tr>
    <tr>
      <th>taxonDF</th>
      <td><p>A data.frame containing data on nodes (both
tips and internal nodes) output by various internal functions.
Can be supplied as input to spead up repeated calculations, but by default is
<code>NULL</code>, which instead forces a calculation from input <code>phy</code>.</p></td>
    </tr>
    <tr>
      <th>checkTimeStep</th>
      <td><p>If <code>TRUE</code>, warnings will be issued if <code>TimeStep</code> is too short.</p></td>
    </tr>
    </table>

    <h2 class="hasAnchor" id="value"><a class="anchor" href="#value"></a>Value</h2>

    <p>If <code>returnAll = FALSE</code> (the default),
this function returns a data frame of species character (tip)
values in the tree, as a single column named 'states'
with rownames reflecting the taxon names given in 
<code>phy$tip.label</code>.
If <code>returnAll = TRUE</code>, the raw <code>data.frame</code>
from the simulation will instead be returned.</p>
    <h2 class="hasAnchor" id="details"><a class="anchor" href="#details"></a>Details</h2>

    <p>The phylogenetic tree used is rescaled such that the
distance from the root to the furthest tip is rescaled to equal 1 time-unit, 
and it is this rescaled edge lengths to with arguments
<code>timeStep</code> refers to. Typically, this will be determined though
as a ratio of <code>TreeYears</code> (which is the number
of calendar years constituing the root-to-furthest-tip distance, and
is determined by default as if the user had supplied
a tree with edge lengths in time-units of 1 time-unit = 1 million years), and
<code>generation.time</code>, which gives the length of
<code>timeSteps</code> in calendar years (e.g. <code>generation.time = 1000</code> means
an evolutionary change in trait values every 1000 years).
Note that the real number of trait change events simulated may be less
less, because simulations start ver at each branching
node, but intervals between changes should be so fine that this
should be negligible (related, the results should be
independent of your choice for <code>generation.time</code> or <code>timeStep</code>).
We recommend that the effective <code>timeStep</code> should be 
as short as is computationally possible.
<code>SaveRealParams</code> is useful for tracking the <em>real</em> true values if simulating
data to test the performance of ABC analyses.  
It is not useful for ABC analyses of empirical data.</p>
    <h2 class="hasAnchor" id="note"><a class="anchor" href="#note"></a>Note</h2>

    <p>The <code><a href='simulateWithPriors.html'>simulateWithPriors</a></code> functions are effectively
the engine that powers the <code><a href='doRun.html'>doRun</a></code>
functions, while the <code>doSimulation</code> functions are
the pistons within the <code><a href='simulateWithPriors.html'>simulateWithPriors</a></code> engine.
In general, most users will just drive the car - they will just
use <code><a href='doRun.html'>doRun</a></code>, but some users may
want to use <code><a href='simulateWithPriors.html'>simulateWithPriors</a></code> or
<code>doSimulation</code> functions to do various simulations.</p>
    <h2 class="hasAnchor" id="author"><a class="anchor" href="#author"></a>Author</h2>

    <p>Brian O'Meara and Barb Banbury</p>

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><div class='input'>
<span class='co'># \donttest{</span>

<span class='fu'><a href='https://rdrr.io/r/base/Random.html'>set.seed</a></span><span class='op'>(</span><span class='fl'>1</span><span class='op'>)</span>
<span class='va'>tree</span> <span class='op'>&lt;-</span> <span class='fu'>rcoal</span><span class='op'>(</span><span class='fl'>20</span><span class='op'>)</span>
<span class='co'># get realistic edge lengths</span>
<span class='va'>tree</span><span class='op'>$</span><span class='va'>edge.length</span> <span class='op'>&lt;-</span> <span class='va'>tree</span><span class='op'>$</span><span class='va'>edge.length</span><span class='op'>*</span><span class='fl'>20</span>

<span class='co'>#Simple Brownian motion</span>

<span class='va'>char</span> <span class='op'>&lt;-</span> <span class='fu'>doSimulation</span><span class='op'>(</span>
    phy <span class='op'>=</span> <span class='va'>tree</span>, 
    generation.time <span class='op'>=</span> <span class='fl'>100000</span>, 
    intrinsicFn <span class='op'>=</span> <span class='va'>brownianIntrinsic</span>, 
    extrinsicFn <span class='op'>=</span> <span class='va'>nullExtrinsic</span>, 
    startingValues <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>10</span><span class='op'>)</span>, <span class='co'>#root state</span>
    intrinsicValues <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>0.01</span><span class='op'>)</span>, 
    extrinsicValues <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>0</span><span class='op'>)</span><span class='op'>)</span>
</div><div class='output co'>#&gt; <span class='warning'>Warning: You have only 22 timeSteps on the shortest branch in this dataset</span>
#&gt; <span class='warning'> but should probably have a lot more if you expect change on this branch.</span>
#&gt; <span class='warning'> Please consider decreasing timeStep to no more than 0.0016</span></div><div class='input'>
<span class='co'>#Character displacement model with minimum bound</span>

<span class='va'>char</span> <span class='op'>&lt;-</span> <span class='fu'>doSimulation</span><span class='op'>(</span>
    phy <span class='op'>=</span> <span class='va'>tree</span>, 
    generation.time <span class='op'>=</span> <span class='fl'>100000</span>, 
    intrinsicFn <span class='op'>=</span> <span class='va'>boundaryMinIntrinsic</span>, 
    extrinsicFn <span class='op'>=</span> <span class='va'>ExponentiallyDecayingPushExtrinsic</span>, 
    startingValues <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>10</span><span class='op'>)</span>, <span class='co'>#root state</span>
    intrinsicValues <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>0.05</span>, <span class='fl'>10</span>, <span class='fl'>0.01</span><span class='op'>)</span>, 
    extrinsicValues <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>0</span>, <span class='fl'>.1</span>, <span class='fl'>.25</span><span class='op'>)</span><span class='op'>)</span>
</div><div class='output co'>#&gt; <span class='warning'>Warning: You have only 22 timeSteps on the shortest branch in this dataset</span>
#&gt; <span class='warning'> but should probably have a lot more if you expect change on this branch.</span>
#&gt; <span class='warning'> Please consider decreasing timeStep to no more than 0.0016</span></div><div class='input'>
<span class='co'># }</span>
</div></pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top">
      <h2 data-toc-skip>Contents</h2>
    </nav>
  </div>
</div>


      <footer>
      <div class="copyright">
  <p>Developed by Brian O'Meara, David Bapst, Barb Banbury.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
   </div>

  


  </body>
</html>


