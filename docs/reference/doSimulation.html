<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html>
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Discrete-Time Character Simulation — doSimulation • TreEvo</title>

<!-- jquery -->
<script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script>
<!-- Bootstrap -->

<link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>

<!-- Font Awesome icons -->
<link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/1.7.1/clipboard.min.js" integrity="sha384-cV+rhyOuRHc9Ub/91rihWcGmMmCXDeksTtCihMupQHSsi8GIIRDG0ThDc3HGQFJ3" crossorigin="anonymous"></script>

<!-- sticky kit -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/sticky-kit/1.1.3/sticky-kit.min.js" integrity="sha256-c4Rlo1ZozqTPE2RLuvbusY3+SU1pQaJC0TjuhygMipw=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>



<meta property="og:title" content="Discrete-Time Character Simulation — doSimulation" />

<meta property="og:description" content="The function doSimulation evolves continuous characters under a discrete time process.
These functions are mainly used as internal components, generating simulations
within ABC analyses using the doRun functions. See Note below." />
<meta name="twitter:card" content="summary" />



<!-- mathjax -->
<script src='https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML'></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->


  </head>

  <body>
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">TreEvo</a>
        <span class="label label-default" data-toggle="tooltip" data-placement="bottom" title="Released package">0.9.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="../articles/treevo_ABC_vignette.html">Analyzing Trait Evolution with Approximate Bayesian Computation in TreEvo</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
      
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/bomeara/treevo">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      
      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Discrete-Time Character Simulation</h1>
    <small class="dont-index">Source: <a href='https://github.com/bomeara/treevo/blob/master/R/doSimulation.R'><code>R/doSimulation.R</code></a></small>
    <div class="hidden name"><code>doSimulation.Rd</code></div>
    </div>

    <div class="ref-description">
    
    <p>The function <code>doSimulation</code> evolves continuous characters under a discrete time process.
These functions are mainly used as internal components, generating simulations
within ABC analyses using the <code><a href='doRun.html'>doRun</a></code> functions. See <em>Note</em> below.</p>
    
    </div>

    <pre class="usage"><span class='fu'>doSimulation</span>(<span class='kw'>phy</span> <span class='kw'>=</span> <span class='kw'>NULL</span>, <span class='no'>intrinsicFn</span>, <span class='no'>extrinsicFn</span>, <span class='no'>startingValues</span>,
  <span class='no'>intrinsicValues</span>, <span class='no'>extrinsicValues</span>, <span class='kw'>generation.time</span> <span class='kw'>=</span> <span class='fl'>1000</span>,
  <span class='kw'>TreeYears</span> <span class='kw'>=</span> <span class='fu'>max</span>(<span class='fu'>branching.times</span>(<span class='no'>phy</span>)) * <span class='fl'>1e+06</span>, <span class='kw'>timeStep</span> <span class='kw'>=</span> <span class='kw'>NULL</span>,
  <span class='kw'>returnAll</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>, <span class='kw'>taxonDF</span> <span class='kw'>=</span> <span class='kw'>NULL</span>, <span class='kw'>checkTimeStep</span> <span class='kw'>=</span> <span class='fl'>TRUE</span>)</pre>
    
    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>phy</th>
      <td><p>A phylogenetic tree, in package <code>ape</code>'s <code>phylo</code> format.</p></td>
    </tr>
    <tr>
      <th>intrinsicFn</th>
      <td><p>Name of (previously-defined) function that governs how
traits evolve within a lineage, regardless of the trait values of other taxa.</p></td>
    </tr>
    <tr>
      <th>extrinsicFn</th>
      <td><p>Name of (previously-defined) function that governs how
traits evolve within a lineage, based on their own ('internal') trait vlaue and the trait values
of other taxa.</p></td>
    </tr>
    <tr>
      <th>startingValues</th>
      <td><p>State at the root.</p></td>
    </tr>
    <tr>
      <th>intrinsicValues</th>
      <td><p>Vector of values corresponding to the parameters of the
intrinsic model.</p></td>
    </tr>
    <tr>
      <th>extrinsicValues</th>
      <td><p>Vector of values corresponding to the parameters of the
extrinsic model.</p></td>
    </tr>
    <tr>
      <th>generation.time</th>
      <td><p>The number of years per generation. This sets the coarseness of the simulation; if it's set to 1000, 
for example, the population's trait values change every 1000 calender years. Note that this is in calender years (see description
for argument <code>TreeYears</code>), and not in millions of years (as is typical for dated trees in macroevolutionary studies).
Thus, if a branch is 1 million-year time-unit long, and a user applies the default <code>generation.time = 1000</code>, 
then 1000 evolutionary changes will be simulated along that branch.
See documentation for <code>doSimulation</code> for further details.</p></td>
    </tr>
    <tr>
      <th>TreeYears</th>
      <td><p>The amount of calender time from the root to the furthest tip. Most trees in macroevolutionary studies are dated with
branch lengths in units of millions of years, and thus the default for this argument is <code>max(branching.times(phy)) * 1e6</code>.
If your tree has the most recent tip at time zero (i.e., the modern day), this would be the same as the root age of the tree. If your
branch lengths are not in millions of years, you should alter this argument. Otherwise, leave this argument alone.
See documentation for <code>doSimulation</code> for further details.</p></td>
    </tr>
    <tr>
      <th>timeStep</th>
      <td><p>This value corresponds to the lenght of intervals between discrete evolutionary events ('generations')
simulated along branches, relative to a rescaled tree where the root to furthest tip distance is 1. For example, 
<code>timeStep = 0.01</code> of would mean 100 (i.e., 1 / 0.01) evolutionary changes would be expected to occur from
the root to the furthest tip. (Note that the real number simulated will be much less, because simulations start
over at each branching node.) Ideally, <code>timeStep</code> (or its effective value, via other arguments) should be
as short as is computationally possible.
Typically <code>NULL</code> by default and
determined internally as follows: <code>timeStep = generation.time / TreeYears</code>.
Can be provided a value as an alternative to using arguments <code>generation.time</code>
and <code>TreeYears</code>, which would then be overridden.
See documentation for <code>doSimulation</code> for further details.</p></td>
    </tr>
    <tr>
      <th>returnAll</th>
      <td><p>If <code>TRUE</code>, the output returned is a <code>data.frame</code> containing the values at each node from the simulation.</p></td>
    </tr>
    <tr>
      <th>taxonDF</th>
      <td><p>A data.frame containing data on nodes (both tips and internal nodes) output by various internal functions.
Can be supplied as input to spead up repeated calculations, but by default is
<code>NULL</code>, which instead forces a calculation from input <code>phy</code>.</p></td>
    </tr>
    <tr>
      <th>checkTimeStep</th>
      <td><p>If <code>TRUE</code>, warnings will be issued if <code>TimeStep</code> is too short.</p></td>
    </tr>
    </table>
    
    <h2 class="hasAnchor" id="value"><a class="anchor" href="#value"></a>Value</h2>

    <p>If <code>returnAll = FALSE</code> (the default), this function returns a data frame of species character (tip)
values in the tree, with column headings <code>taxonid</code> (representing the index for the corresponding tip label
the most recent divergence event for that lineage), and <code>statesmatrix</code> (the simulated trait data).
If <code>returnAll = TRUE</code>, the raw <code>data.frame</code> from the simulation will instead be returned.</p>
    
    <h2 class="hasAnchor" id="details"><a class="anchor" href="#details"></a>Details</h2>

    <p>The phylogenetic tree used is rescaled such that the distance from the root to the furthest tip is rescaled to equal 1 time-unit, 
and it is this rescaled edge lengths to with arguments <code>timeStep</code> refers to. Typically, this will be determined though
as a ratio of <code>TreeYears</code> (which is the number of calender years constituing the root-to-furthest-tip distance, and
is determined by default as if the user had supplied a tree with edge lengths in time-units of 1 time-unit = 1 million years), and
<code>generation.time</code>, which gives the length of <code>timeSteps</code> in calender years (e.g. <code>generation.time = 1000</code> means
an evolutionary change in trait values every 1000 years). Note that the real number of trait change events simulated may be less
less, because simulations start ver at each branching node, but intervals between changes should be so fine that this
should be negligible (related, the results should be independent of your choice for <code>generation.time</code> or <code>timeStep</code>).
We recommend that the effective <code>timeStep</code> should be  as short as is computationally possible.
<code>SaveRealParams</code> is useful for tracking the <em>real</em> true values if simulating
data to test the performance of ABC analyses.  It is not useful for ABC analyses of empirical data.</p>
    
    <h2 class="hasAnchor" id="note"><a class="anchor" href="#note"></a>Note</h2>

    <p>The <code><a href='simulateWithPriors.html'>simulateWithPriors</a></code> functions are effectively the engine that powers the <code><a href='doRun.html'>doRun</a></code>
functions, while the <code>doSimulation</code> functions are the pistons within the <code><a href='simulateWithPriors.html'>simulateWithPriors</a></code> engine.
In general, most users will just drive the car - they will just use <code><a href='doRun.html'>doRun</a></code>, but some users may
want to use <code><a href='simulateWithPriors.html'>simulateWithPriors</a></code> or <code>doSimulation</code> functions to do various simulations.</p>
    

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><div class='input'><span class='fu'>set.seed</span>(<span class='fl'>1</span>)
<span class='no'>tree</span> <span class='kw'>&lt;-</span> <span class='fu'>rcoal</span>(<span class='fl'>20</span>)
<span class='co'># get realistic edge lengths</span>
<span class='no'>tree</span>$<span class='no'>edge.length</span> <span class='kw'>&lt;-</span> <span class='no'>tree</span>$<span class='no'>edge.length</span>*<span class='fl'>20</span>

<span class='co'>#Simple Brownian motion</span>

<span class='no'>char</span> <span class='kw'>&lt;-</span> <span class='fu'>doSimulation</span>(
    <span class='kw'>phy</span> <span class='kw'>=</span> <span class='no'>tree</span>,
    <span class='kw'>generation.time</span> <span class='kw'>=</span> <span class='fl'>100000</span>,
    <span class='kw'>intrinsicFn</span> <span class='kw'>=</span> <span class='no'>brownianIntrinsic</span>,
    <span class='kw'>extrinsicFn</span> <span class='kw'>=</span> <span class='no'>nullExtrinsic</span>,
    <span class='kw'>startingValues</span> <span class='kw'>=</span> <span class='fu'>c</span>(<span class='fl'>10</span>), <span class='co'>#root state</span>
    <span class='kw'>intrinsicValues</span> <span class='kw'>=</span> <span class='fu'>c</span>(<span class='fl'>0.01</span>),
    <span class='kw'>extrinsicValues</span> <span class='kw'>=</span> <span class='fu'>c</span>(<span class='fl'>0</span>))</div><div class='output co'>#&gt; <span class='warning'>Warning: You have only 15 timeSteps on the shortest branch in this dataset but should probably have a lot more if you expect change on this branch. Please consider decreasing timeStep to no more than 0.0011</span></div><div class='input'>
<span class='co'>#Character displacement model with minimum bound</span>

<span class='no'>char</span> <span class='kw'>&lt;-</span> <span class='fu'>doSimulation</span>(
    <span class='kw'>phy</span> <span class='kw'>=</span> <span class='no'>tree</span>,
 <span class='kw'>generation.time</span> <span class='kw'>=</span> <span class='fl'>100000</span>,
    <span class='kw'>intrinsicFn</span> <span class='kw'>=</span> <span class='no'>boundaryMinIntrinsic</span>,
    <span class='kw'>extrinsicFn</span> <span class='kw'>=</span> <span class='no'>ExponentiallyDecayingPushExtrinsic</span>,
    <span class='kw'>startingValues</span> <span class='kw'>=</span> <span class='fu'>c</span>(<span class='fl'>10</span>), <span class='co'>#root state</span>
    <span class='kw'>intrinsicValues</span> <span class='kw'>=</span> <span class='fu'>c</span>(<span class='fl'>0.05</span>, <span class='fl'>10</span>, <span class='fl'>0.01</span>),
    <span class='kw'>extrinsicValues</span> <span class='kw'>=</span> <span class='fu'>c</span>(<span class='fl'>0</span>, <span class='fl'>.1</span>, <span class='fl'>.25</span>))</div><div class='output co'>#&gt; <span class='warning'>Warning: You have only 15 timeSteps on the shortest branch in this dataset but should probably have a lot more if you expect change on this branch. Please consider decreasing timeStep to no more than 0.0011</span></div></pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
    <h2>Contents</h2>
    <ul class="nav nav-pills nav-stacked">
      <li><a href="#arguments">Arguments</a></li>
      
      <li><a href="#value">Value</a></li>

      <li><a href="#details">Details</a></li>

      <li><a href="#note">Note</a></li>
      
      <li><a href="#examples">Examples</a></li>
    </ul>

    <h2>Author</h2>
    
Brian O'Meara and Barb Banbury

Brian O'Meara and Barb Banbury

  </div>
</div>

      <footer>
      <div class="copyright">
  <p>Developed by Brian O'Meara, Barb Banbury, David Bapst.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="http://pkgdown.r-lib.org/">pkgdown</a>.</p>
</div>

      </footer>
   </div>

  

  </body>
</html>

