<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html>
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Fitting Univariate Partial Least Squares Models to Free Parameters in ABC — PLSmethods â€¢ TreEvo</title>

<!-- jquery -->
<script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script>
<!-- Bootstrap -->

<link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>

<!-- Font Awesome icons -->
<link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">


<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../jquery.sticky-kit.min.js"></script>
<script src="../pkgdown.js"></script>
  
  
<!-- mathjax -->
<script src='https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML'></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->


  </head>

  <body>
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="../index.html">TreEvo</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="../articles/treevo_ABC_vignette.html">Analyzing Trait Evolution with Approximate Bayesian Computation in TreEvo</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">News</a>
</li>
      </ul>
      
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/bomeara/treevo">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      
      </header>

      <div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Fitting Univariate Partial Least Squares Models to Free Parameters in ABC</h1>
    </div>

    
    <p>Function <code>returnPLSModel</code> fits a PLS regression (using <code>plsr</code>) individually to each freely varying parameter of a model, unlike
a true multivariate PLS regression. A secondary step than limits the number
of components to those that explain some minimum cumulative percentage
of variance (see argument <code>variance.cutoff</code>).  For ABC, this seems to result in much
better results, without one parameter dominating the combined variance.</p>
    

    <pre class="usage"><span class='fu'>returnPLSModel</span>(<span class='no'>trueFreeValuesMatrix</span>, <span class='no'>summaryValuesMatrix</span>, <span class='kw'>validation</span> <span class='kw'>=</span> <span class='st'>"CV"</span>,
  <span class='kw'>scale</span> <span class='kw'>=</span> <span class='fl'>TRUE</span>, <span class='kw'>variance.cutoff</span> <span class='kw'>=</span> <span class='fl'>95</span>, <span class='no'>...</span>)

<span class='fu'>PLSTransform</span>(<span class='no'>summaryValuesMatrix</span>, <span class='no'>pls.model</span>)</pre>
    
    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a> Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>trueFreeValuesMatrix</th>
      <td><p>Matrix of true free values from simulations.</p></td>
    </tr>
    <tr>
      <th>summaryValuesMatrix</th>
      <td><p>Matrix of summary statistics from simulations.</p></td>
    </tr>
    <tr>
      <th>validation</th>
      <td><p>Character argument controlling what validation procedure is used by <code>plsr</code>.
Default is <code>"CV"</code> for cross-validation.</p></td>
    </tr>
    <tr>
      <th>scale</th>
      <td><p>This argument is passed to <code>plsr</code>.  It may be a numeric vector, or logical. If numeric vector, 
the input is scaled by dividing each variable with the corresponding element of scale. 
If <code>scale = TRUE</code>, the inpus is scaled by dividing each variable by its sample standard deviation. 
If cross-validation is selected (the default for <code>returnPLSModel</code>),
scaling by the standard deviation is done for every segment.</p></td>
    </tr>
    <tr>
      <th>variance.cutoff</th>
      <td><p>Minimum threshold percentage of variance explained for the
number of components included in the final PLS model fit. This value is a 
percentage and must be between 0 and 100. Default is 95 percent.</p></td>
    </tr>
    <tr>
      <th>...</th>
      <td><p>Additional arguments, passed to <code>plsr</code>. In particular, if the number of observations is less than
10 (such as for the example below), it may be necessary to pass a revised <code>segments</code> argument, which 
<code>plsr</code> passes to <code>mvrCv</code>, as the default <code>segments</code> value is 10 (and there cannot be more segments
than observations). Note that this should be an atypical situation outside of examples, as the number of observations
should often be much greater than 10.</p></td>
    </tr>
    <tr>
      <th>pls.model</th>
      <td><p>Output from <code>returnPLSModel</code>.</p></td>
    </tr>
    </table>
    
    <h2 class="hasAnchor" id="value"><a class="anchor" href="#value"></a>Value</h2>

    <p>Function <code>returnPLSModel</code> returns a PLS model, and function <code>PLSTransform</code> returns transformed summary statistics.</p>
    
    <h2 class="hasAnchor" id="details"><a class="anchor" href="#details"></a>Details</h2>

    <p>Function <code>PLSTransform</code> uses results from a Partial Least Squares (PLS) model fit with <code>returnPLSModel</code> to transform summary values.</p>
    
    <h2 class="hasAnchor" id="see-also"><a class="anchor" href="#see-also"></a>See also</h2>

    <p>Function <code>returnPLSModel</code> effectively wraps function <code>plsr</code> from package <code>mvr</code>.</p>
    

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><div class='input'><span class='fu'>set.seed</span>(<span class='fl'>1</span>)
<span class='fu'>data</span>(<span class='no'>simRunExample</span>)</div><div class='output co'>#&gt; <span class='warning'>Warning: data set ‘simRunExample’ not found</span></div><div class='input'>
<span class='co'># example simulation</span>

<span class='no'>nSimulations</span><span class='kw'>&lt;-</span><span class='fl'>6</span>

<span class='no'>simDataParallel</span><span class='kw'>&lt;-</span><span class='fu'><a href='simulateWithPriors.html'>parallelSimulateWithPriors</a></span>(
  <span class='kw'>nrepSim</span><span class='kw'>=</span><span class='no'>nSimulations</span>, <span class='kw'>multicore</span><span class='kw'>=</span><span class='fl'>FALSE</span>, <span class='kw'>coreLimit</span><span class='kw'>=</span><span class='fl'>1</span>,
  <span class='kw'>phy</span><span class='kw'>=</span><span class='no'>simPhy</span>,
  <span class='kw'>intrinsicFn</span><span class='kw'>=</span><span class='no'>brownianIntrinsic</span>,
  <span class='kw'>extrinsicFn</span><span class='kw'>=</span><span class='no'>nullExtrinsic</span>,
  <span class='kw'>startingPriorsFns</span><span class='kw'>=</span><span class='st'>"normal"</span>,
  <span class='kw'>startingPriorsValues</span><span class='kw'>=</span><span class='fu'>matrix</span>(<span class='fu'>c</span>(<span class='fu'>mean</span>(<span class='no'>simChar</span>[,<span class='fl'>1</span>]), <span class='fu'>sd</span>(<span class='no'>simChar</span>[,<span class='fl'>1</span>]))),
  <span class='kw'>intrinsicPriorsFns</span><span class='kw'>=</span><span class='fu'>c</span>(<span class='st'>"exponential"</span>),
  <span class='kw'>intrinsicPriorsValues</span><span class='kw'>=</span><span class='fu'>matrix</span>(<span class='fu'>c</span>(<span class='fl'>10</span>, <span class='fl'>10</span>), <span class='kw'>nrow</span><span class='kw'>=</span><span class='fl'>2</span>, <span class='kw'>byrow</span><span class='kw'>=</span><span class='fl'>FALSE</span>),
  <span class='kw'>extrinsicPriorsFns</span><span class='kw'>=</span><span class='fu'>c</span>(<span class='st'>"fixed"</span>),
  <span class='kw'>extrinsicPriorsValues</span><span class='kw'>=</span><span class='fu'>matrix</span>(<span class='fu'>c</span>(<span class='fl'>0</span>, <span class='fl'>0</span>), <span class='kw'>nrow</span><span class='kw'>=</span><span class='fl'>2</span>, <span class='kw'>byrow</span><span class='kw'>=</span><span class='fl'>FALSE</span>),
  <span class='kw'>timeStep</span><span class='kw'>=</span><span class='fl'>1e-04</span>,
  <span class='kw'>checkpointFile</span><span class='kw'>=</span><span class='kw'>NULL</span>, <span class='kw'>checkpointFreq</span><span class='kw'>=</span><span class='fl'>24</span>,
  <span class='kw'>verbose</span><span class='kw'>=</span><span class='fl'>FALSE</span>,
  <span class='kw'>freevector</span><span class='kw'>=</span><span class='kw'>NULL</span>, <span class='kw'>taxon.df</span><span class='kw'>=</span><span class='kw'>NULL</span>,
  <span class='kw'>niter.brown</span><span class='kw'>=</span><span class='fl'>25</span>, <span class='kw'>niter.lambda</span><span class='kw'>=</span><span class='fl'>25</span>, <span class='kw'>niter.delta</span><span class='kw'>=</span><span class='fl'>25</span>, <span class='kw'>niter.OU</span><span class='kw'>=</span><span class='fl'>25</span>, <span class='kw'>niter.white</span><span class='kw'>=</span><span class='fl'>25</span>)</div><div class='output co'>#&gt; <span class='message'>You have only 2 timeSteps on the shortest branch in this dataset but should probably have a lot more if you expect change on this branch. Please consider decreasing timeStep to no more than 5.5e-06 or at the very least 9.2e-05</span></div><div class='output co'>#&gt; <span class='message'>Using 1 core(s) for simulations </span>
#&gt; <span class='message'></span></div><div class='output co'>#&gt; <span class='message'>Doing simulations: </span></div><div class='output co'>#&gt; <span class='message'>.</span></div><div class='output co'>#&gt; <span class='message'>.</span></div><div class='output co'>#&gt; <span class='message'>.</span></div><div class='output co'>#&gt; <span class='message'>.</span></div><div class='output co'>#&gt; <span class='message'>.</span></div><div class='output co'>#&gt; <span class='message'>.</span></div><div class='input'>
<span class='no'>nParFree</span><span class='kw'>&lt;-</span><span class='fu'>sum</span>(<span class='fu'>attr</span>(<span class='no'>simDataParallel</span>,<span class='st'>"freevector"</span>))

<span class='co'>#separate the simulation results: 'true' generating parameter values from the summary values</span>
<span class='no'>trueFreeValuesMat</span><span class='kw'>&lt;-</span><span class='no'>simDataParallel</span>[,<span class='fl'>1</span>:<span class='no'>nParFree</span>]
<span class='no'>summaryValuesMat</span><span class='kw'>&lt;-</span><span class='no'>simDataParallel</span>[,-<span class='fl'>1</span>:-<span class='no'>nParFree</span>]

<span class='no'>PLSmodel</span><span class='kw'>&lt;-</span><span class='fu'>returnPLSModel</span>(<span class='kw'>trueFreeValuesMatrix</span><span class='kw'>=</span><span class='no'>trueFreeValuesMat</span>,
                <span class='kw'>summaryValuesMatrix</span><span class='kw'>=</span><span class='no'>summaryValuesMat</span>,
                <span class='kw'>validation</span><span class='kw'>=</span><span class='st'>"CV"</span>, <span class='kw'>scale</span><span class='kw'>=</span><span class='fl'>TRUE</span>, <span class='kw'>variance.cutoff</span><span class='kw'>=</span><span class='fl'>95</span> , <span class='kw'>segments</span> <span class='kw'>=</span> <span class='no'>nSimulations</span>)</div><div class='output co'>#&gt; <span class='warning'>Warning: in practice, doing PLS works best if you do each free parameter separately, so one parameter does not dominate</span></div><div class='input'>
<span class='no'>PLSmodel</span></div><div class='output co'>#&gt; Partial least squares regression , fitted with the kernel algorithm.
#&gt; Call:
#&gt; plsr(formula = trueFreeValuesMatrix ~ summaryValuesMatrix, ncomp = ncomp.final,     scale = scale, validation = "none", segments = ..1)</div><div class='input'>
<span class='fu'>PLSTransform</span>(<span class='kw'>summaryValuesMatrix</span><span class='kw'>=</span><span class='no'>summaryValuesMat</span>, <span class='kw'>pls.model</span><span class='kw'>=</span><span class='no'>PLSmodel</span>)</div><div class='output co'>#&gt;              Comp 1     Comp 2      Comp 3
#&gt; result.1 -7.8307352 -0.8322944  3.20924381
#&gt; result.2  3.8478682  8.2667362 -0.02378598
#&gt; result.3  0.8870224 -1.8778328 -7.11135336
#&gt; result.4 -5.2372870 -1.1874246 -0.21676280
#&gt; result.5 13.9481967 -3.4459104  2.74270421
#&gt; result.6 -5.6150651 -0.9232740  1.39995411</div></pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
    <h2>Contents</h2>
    <ul class="nav nav-pills nav-stacked">
      <li><a href="#arguments">Arguments</a></li>
      
      <li><a href="#value">Value</a></li>

      <li><a href="#details">Details</a></li>

      <li><a href="#see-also">See also</a></li>
      
      <li><a href="#examples">Examples</a></li>
    </ul>

    <h2>Author</h2>
    
Brian O'Meara and Barb Banbury

  </div>
</div>

      <footer>
      <div class="copyright">
  <p>Developed by Brian O'Meara, Barb Banbury, David Bapst.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="http://hadley.github.io/pkgdown/">pkgdown</a>.</p>
</div>

      </footer>
   </div>

  </body>
</html>
